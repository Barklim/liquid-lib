---
title: Комплектование модулей
docUrl: https://rollupjs.org/guide/en/
---

Процесс сборки библиотеки во многом похож на приложения. Мы хотим взять одну точку входа, содержащую наши компоненты, и связать их вместе в выходной файл. При создании приложений целевой средой является веб-браузер. [Webpack] (https://webpack.js.org/) - популярный сборщик модулей, который помогает объединить широкий спектр ресурсов в вывод, понятный браузерам.

Для библиотек целевая среда часто является другой средой разработки, а не браузером. Это меняет тип активов, которые мы можем производить, и инструменты, необходимые для их создания. Будем использовать [RollupJS] (https://rollupjs.org/guide/en/) в качестве сборщика модулей.

## Форматы модулей

Изначально не существовало открытого стандарта для импорта / экспорта модулей JavaScript. Со временем было разработано множество форматов, в которых это реализовано, каждый со своими уникальными преимуществами. Некоторые распространенные форматы включают:

- **CommonJS (CJS)**
  - Модульная система, которую Node.js исторически использовала
  - Только на серверной части
  - `require` и `module.exports`
- **ESModules (ES)**
  - Официальная спецификация для [стандартной системы модулей] (https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/)
  - Может работать в серверной и современной браузерной среде.
  - `import` и `export`
  - _Supports tree-shaking_
    - [Tree-shaking](https://developers.google.com/web/fundamentals/performance/optimizing-javascript/tree-shaking/) позволяет современным сборщикам пакетов, таким как Webpack и RollupJS, удалять JavaScript, который не требуется для запуска вашего приложения.
- **Universal Module Definition (UMD)**
  - Позволяет множеству различных форматов модулей взаимодействовать с вашей библиотекой
  - Может работать в серверных и браузерных средах
  - Невозможно сделать tree-shake

## Многодистрибутивные пакеты

Когда мы создаем нашу библиотеку, нам не нужно выбирать единый формат модуля. Мы можем предоставить несколько форматов и ссылаться на них с уникальными точками входа в нашем `package.json`. Популярные точки входа:

- `main`
  - CommonJS entry-point
- `module`
  - ESModules entry-point
- `browser`
  - UMD entry-point

Современные сборщики пакетов могут смотреть на точки входа, чтобы определить, какой формат использовать. Мы будем предоставлять только дистрибутивы CommonJS и ESModules.

## Babel

Объединение модулей важно, но нам все еще нужно создавать JavaScript в формате, понятном браузерам. В зависимости от минимальных требований к браузеру некоторые современные функции JavaScript могут быть недоступны. [Babel] (https://babeljs.io/docs/en/index.html) - это инструмент, который может помочь преобразовать наш код в формат, понятный старым браузерам. Babel также позволяет другим инструментам и библиотекам создавать предустановки, улучшающие наш код. [@ babel / preset-response] (https://babeljs.io/docs/en/babel-preset-react) обеспечивает правильную обработку синтаксиса JSX. Мы также будем использовать [плагин babel styled-components] (https://styled-components.com/docs/tooling), чтобы улучшить использование CSS-in-JS в производстве.

Мы будем использовать Babel в сочетании с RollupJS для объединения нашего приложения.

Добавим аналогичный процесс сборки в нашу библиотеку компонентов.
